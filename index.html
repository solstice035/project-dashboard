<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Dashboard</title>
    <!-- Design System Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Playfair+Display:wght@700;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/kanban.css">
</head>
<body data-theme="dark">
    <!-- Sticky Top Bar -->
    <header class="top-bar">
        <div class="top-bar-inner">
            <h1 class="logo"><i data-lucide="target" class="icon"></i> Dashboard</h1>

            <!-- Navigation Tabs -->
            <nav class="tabs">
                <button class="tab active" data-tab="command-center">
                    <i data-lucide="layout-dashboard" class="icon"></i> Command
                </button>
                <button class="tab" data-tab="kanban">
                    <i data-lucide="kanban" class="icon"></i> Kanban
                </button>
                <button class="tab" data-tab="life">
                    <i data-lucide="heart" class="icon"></i> Life
                </button>
                <button class="tab" data-tab="plan">
                    <i data-lucide="message-square" class="icon"></i> Plan
                </button>
                <button class="tab" data-tab="analytics">
                    <i data-lucide="trending-up" class="icon"></i> Analytics
                </button>
                <button class="tab" data-tab="school">
                    <i data-lucide="graduation-cap" class="icon"></i> School
                </button>
                <button class="tab" data-tab="financial">
                    <i data-lucide="wallet" class="icon"></i> Financial
                </button>
                <button class="tab" data-tab="rss">
                    <i data-lucide="rss" class="icon"></i> News
                </button>
            </nav>

            <div class="header-right">
                <!-- Life Pulse Widget -->
                <div class="life-pulse" onclick="switchTab('life')" title="XP earned today">
                    <span class="life-pulse-xp" id="life-pulse-xp">+0</span>
                    <span class="life-pulse-label">XP today</span>
                </div>

                <!-- Needs Attention Badge -->
                <div id="attention-badge" class="attention-badge hidden">
                    <i data-lucide="alert-triangle" class="icon"></i>
                    <span class="count">0</span>
                    <div id="attention-dropdown" class="attention-dropdown"></div>
                </div>

                <div class="status-indicators">
                    <div class="status-dot loading" id="status-git" title="Git"></div>
                    <div class="status-dot loading" id="status-todoist" title="Todoist"></div>
                    <div class="status-dot loading" id="status-kanban" title="Kanban"></div>
                    <div class="status-dot loading" id="status-linear" title="Linear"></div>
                    <div class="status-dot loading" id="status-rss" title="RSS/News"></div>
                </div>
                <button class="refresh-btn" id="refresh-btn" onclick="refreshAll()">
                    <i data-lucide="refresh-cw" class="icon"></i>
                </button>
                <span class="last-updated" id="last-updated">--:--</span>
            </div>
        </div>
    </header>

    <div class="container">

        <!-- Command Center Tab (Dashboard + Standup + Overnight combined) -->
        <div id="tab-command-center" class="tab-content active">
            <!-- NEEDS ATTENTION - Alert Section (Aggregated) -->
            <div class="card card-alert full-width" id="needs-attention-card">
                <div class="card-header" onclick="toggleNeedsAttention()">
                    <span class="card-title"><i data-lucide="alert-triangle" class="icon"></i> Needs Attention</span>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span class="card-badge urgent" id="needs-attention-count">0</span>
                        <i data-lucide="chevron-down" class="icon collapse-icon" id="needs-attention-chevron"></i>
                    </div>
                </div>
                <div class="card-content" id="needs-attention-content">
                    <div class="empty-state" id="needs-attention-empty">
                        <div class="empty-state-icon"><i data-lucide="check-circle" class="icon"></i></div>
                        <div class="empty-state-text">All clear — nothing needs immediate attention</div>
                    </div>
                    <div id="needs-attention-items" style="display: none;"></div>
                </div>
            </div>

            <!-- Hero Row: Today's Focus + In Progress -->
            <div class="dashboard-grid hero-row">
                <!-- Today's Focus (Featured Card) -->
                <div class="card card-featured" id="today-card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="target" class="icon"></i> Today's Focus</span>
                        <button class="btn-ghost" onclick="askJeevesForFocus()" title="Get AI suggestions">
                            <i data-lucide="sparkles" class="icon"></i>
                        </button>
                    </div>
                    <div class="card-content" id="todays-focus-content">
                        <div class="empty-state">
                            <div class="empty-state-icon"><i data-lucide="compass" class="icon"></i></div>
                            <div class="empty-state-text">No focus set for today</div>
                            <div class="empty-state-hint">You have <span id="ready-count">0</span> items ready to start</div>
                            <button class="btn-primary" onclick="switchTab('plan')">
                                <i data-lucide="sparkles" class="icon"></i> Plan with Jeeves
                            </button>
                        </div>
                    </div>
                </div>

                <!-- In Progress -->
                <div class="card" id="inprogress-card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="play-circle" class="icon"></i> In Progress</span>
                        <span class="card-badge" id="inprogress-count">0</span>
                    </div>
                    <div class="card-content" id="inprogress-content">
                        <div class="empty-state">
                            <div class="empty-state-icon"><i data-lucide="rocket" class="icon"></i></div>
                            <div class="empty-state-text">Nothing actively in progress</div>
                            <div class="empty-state-hint">Ready to start something?</div>
                            <button class="btn-secondary" onclick="showReadyItems()">
                                <i data-lucide="list" class="icon"></i> View Ready Items
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Summary Stats Row - Compact -->
            <div class="stat-grid">
                <div class="stat-card">
                    <div class="stat-value" id="standup-overdue-count">-</div>
                    <div class="stat-label">Overdue</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="standup-today-count">-</div>
                    <div class="stat-label">Today</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="standup-inprogress-count">-</div>
                    <div class="stat-label">Active</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="standup-date">-</div>
                    <div class="stat-label" id="standup-weather">Weather</div>
                </div>
            </div>

            <!-- Secondary Row: Ready Items + Activity + Inbox -->
            <div class="dashboard-grid three-col">
                <!-- Ready / Next Up -->
                <div class="card" id="ready-card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="list-checks" class="icon"></i> Ready / Next Up</span>
                        <span class="card-badge" id="ready-badge">0</span>
                    </div>
                    <div class="card-content" id="ready-content"><div class="skeleton"></div></div>
                </div>

                <!-- Activity Summary -->
                <div class="card" id="activity-card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="activity" class="icon"></i> Activity Summary</span>
                    </div>
                    <div class="card-content" id="activity-content"><div class="skeleton"></div></div>
                </div>

                <!-- Inbox Digest -->
                <div class="card" id="inbox-card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="mail" class="icon"></i> Inbox</span>
                        <span class="card-badge" id="inbox-count">-</span>
                    </div>
                    <div class="card-content" id="inbox-content"><div class="skeleton"></div></div>
                </div>
            </div>

            <!-- Collapsed Repository Health -->
            <div class="card collapsible" id="git-card">
                <div class="card-header" onclick="toggleGitRepos()">
                    <span class="card-title"><i data-lucide="folder-git-2" class="icon"></i> Repository Health</span>
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <span class="card-summary" id="git-summary">- repos • - dirty • - commits</span>
                        <i data-lucide="chevron-down" class="icon collapse-icon" id="git-chevron"></i>
                    </div>
                </div>
                <div class="card-content collapsed" id="git-content"><div class="skeleton"></div></div>
            </div>

            <!-- School Email Card -->
            <div class="card" id="school-card">
                <div class="card-header">
                    <span class="card-title"><i data-lucide="graduation-cap" class="icon"></i> School Emails</span>
                    <span class="card-badge" id="school-count">-</span>
                </div>
                <div class="card-content" id="school-content"><div class="skeleton"></div></div>
            </div>

            <!-- Data Sources Row (Collapsed by default) -->
            <div class="dashboard-grid sources-row">
                <!-- Todoist Tasks -->
                <div class="card" id="todoist-card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="clipboard-list" class="icon"></i> Tasks</span>
                        <span class="card-badge" id="todoist-count">-</span>
                    </div>
                    <div class="card-content" id="todoist-content"><div class="skeleton"></div></div>
                </div>

                <!-- Kanban Board -->
                <div class="card" id="kanban-card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="trello" class="icon"></i> Kanban</span>
                        <span class="card-badge" id="kanban-count">-</span>
                    </div>
                    <div class="card-content" id="kanban-content"><div class="skeleton"></div></div>
                </div>

                <!-- Linear Issues -->
                <div class="card" id="linear-card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="bar-chart-3" class="icon"></i> Linear</span>
                        <span class="card-badge" id="linear-count">-</span>
                    </div>
                    <div class="card-content" id="linear-content"><div class="skeleton"></div></div>
                </div>
            </div>
        </div>

        <!-- Kanban Board Tab -->
        <div id="tab-kanban" class="tab-content">
            <div class="kanban-toolbar">
                <div class="kanban-toolbar-left">
                    <h2 style="font-family: var(--font-display); font-size: 1.5rem; margin: 0;">Task Board</h2>
                </div>
                <div class="kanban-toolbar-right">
                    <button class="btn-kanban primary" onclick="KanbanBoard.openModal('backlog')">
                        <i data-lucide="plus" class="icon"></i> New Task
                    </button>
                    <button class="btn-kanban" onclick="KanbanBoard.loadTasks()">
                        <i data-lucide="refresh-cw" class="icon"></i> Refresh
                    </button>
                </div>
            </div>

            <div class="kanban-board">
                <div class="kanban-column" data-kanban-column="backlog">
                    <div class="kanban-column-header">
                        <div class="kanban-column-title">
                            <h3>Backlog</h3>
                            <span class="kanban-column-count">0</span>
                        </div>
                        <span class="kanban-column-label">Ideas & Future Work</span>
                    </div>
                    <div class="kanban-cards"></div>
                </div>

                <div class="kanban-column" data-kanban-column="ready">
                    <div class="kanban-column-header">
                        <div class="kanban-column-title">
                            <h3>Ready</h3>
                            <span class="kanban-column-count">0</span>
                        </div>
                        <span class="kanban-column-label">Queued & Prioritized</span>
                    </div>
                    <div class="kanban-cards"></div>
                </div>

                <div class="kanban-column" data-kanban-column="in-progress">
                    <div class="kanban-column-header">
                        <div class="kanban-column-title">
                            <h3>Active</h3>
                            <span class="kanban-column-count">0</span>
                        </div>
                        <span class="kanban-column-label">Currently Working</span>
                    </div>
                    <div class="kanban-cards"></div>
                </div>

                <div class="kanban-column" data-kanban-column="review">
                    <div class="kanban-column-header">
                        <div class="kanban-column-title">
                            <h3>Review</h3>
                            <span class="kanban-column-count">0</span>
                        </div>
                        <span class="kanban-column-label">Pending Approval</span>
                    </div>
                    <div class="kanban-cards"></div>
                </div>

                <div class="kanban-column" data-kanban-column="done">
                    <div class="kanban-column-header">
                        <div class="kanban-column-title">
                            <h3>Complete</h3>
                            <span class="kanban-column-count">0</span>
                        </div>
                        <span class="kanban-column-label">Finished & Shipped</span>
                    </div>
                    <div class="kanban-cards"></div>
                </div>
            </div>
        </div>

        <!-- Kanban Modal -->
        <div class="kanban-modal" id="kanban-modal">
            <div class="kanban-modal-content">
                <div class="kanban-modal-header" id="kanban-modal-header">Add New Task</div>
                <form id="kanban-task-form" onsubmit="event.preventDefault(); KanbanBoard.saveTask();">
                    <div class="kanban-modal-form">
                        <div class="kanban-form-group">
                            <label for="kanban-task-title">Title</label>
                            <input type="text" id="kanban-task-title" required placeholder="What needs to be done?">
                        </div>
                        <div class="kanban-form-group">
                            <label for="kanban-task-description">Description</label>
                            <textarea id="kanban-task-description" placeholder="Additional details..."></textarea>
                        </div>
                        <div class="kanban-form-group">
                            <label for="kanban-task-tags">Tags</label>
                            <input type="text" id="kanban-task-tags" placeholder="automation, priority, research (comma-separated)">
                        </div>
                        <div class="kanban-form-group">
                            <label for="kanban-task-priority">Priority</label>
                            <select id="kanban-task-priority">
                                <option value="1">Low</option>
                                <option value="2" selected>Normal</option>
                                <option value="3">High</option>
                                <option value="4">Urgent</option>
                            </select>
                        </div>
                        <div class="kanban-form-group">
                            <label for="kanban-task-column">Column</label>
                            <select id="kanban-task-column">
                                <option value="backlog">Backlog</option>
                                <option value="ready">Ready</option>
                                <option value="in-progress">In Progress</option>
                                <option value="review">Review</option>
                                <option value="done">Done</option>
                            </select>
                        </div>
                    </div>
                    <div class="kanban-modal-actions">
                        <button type="button" class="btn-kanban danger" id="kanban-delete-btn" style="display: none;" onclick="KanbanBoard.deleteTask(KanbanBoard.currentTask?.id)">Delete</button>
                        <button type="button" class="btn-kanban" onclick="KanbanBoard.closeModal()">Cancel</button>
                        <button type="submit" class="btn-kanban primary">Save</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Life Balance Tab -->
        <div id="tab-life" class="tab-content">
            <!-- XP Header Bar -->
            <div class="life-header">
                <div class="life-level">
                    <span class="level-badge" id="life-level">Lv 1</span>
                    <div class="level-info">
                        <span class="level-title" id="life-title">Novice</span>
                        <span class="level-xp" id="life-xp">0 XP</span>
                    </div>
                </div>
                <div class="xp-progress-container">
                    <div class="xp-progress-bar">
                        <div class="xp-progress-fill" id="xp-progress-fill" style="width: 0%"></div>
                    </div>
                    <span class="xp-progress-text" id="xp-progress-text">0 / 100 XP to next level</span>
                </div>
                <div class="today-xp">
                    <span class="today-xp-value" id="today-xp">+0</span>
                    <span class="today-xp-label">Today</span>
                </div>
            </div>

            <!-- Quick Log Buttons - PRD's 6 Categories -->
            <div class="quick-log-bar">
                <button class="quick-log-btn" onclick="quickLog('workout')" title="Health: Workout (+50 XP)">
                    <i data-lucide="dumbbell" class="icon"></i>
                    <span>Workout</span>
                </button>
                <button class="quick-log-btn" onclick="quickLog('reading')" title="Learning: Reading (+15 XP)">
                    <i data-lucide="book-open" class="icon"></i>
                    <span>Read</span>
                </button>
                <button class="quick-log-btn" onclick="quickLog('social')" title="Relationships: Social (+20 XP)">
                    <i data-lucide="users" class="icon"></i>
                    <span>Social</span>
                </button>
                <button class="quick-log-btn" onclick="quickLog('hobby')" title="Hobbies: Hobby time (+30 XP)">
                    <i data-lucide="gamepad-2" class="icon"></i>
                    <span>Hobby</span>
                </button>
                <button class="quick-log-btn" onclick="quickLog('chore')" title="Life Admin: Chore (+15 XP)">
                    <i data-lucide="clipboard-check" class="icon"></i>
                    <span>Chore</span>
                </button>
                <button class="quick-log-btn" onclick="quickLog('meditation')" title="Health: Meditation (+25 XP)">
                    <i data-lucide="brain" class="icon"></i>
                    <span>Meditate</span>
                </button>
            </div>

            <!-- Apple Health Stats Row -->
            <div class="stat-grid" id="health-stats-row">
                <div class="stat-card" id="health-score-card">
                    <div class="stat-value" id="health-score-value">-</div>
                    <div class="stat-label">Health Score</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="health-steps">-</div>
                    <div class="stat-label">Steps</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="health-exercise">-</div>
                    <div class="stat-label">Exercise</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="health-rhr">-</div>
                    <div class="stat-label">Resting HR</div>
                </div>
            </div>

            <!-- Health Insights Banner -->
            <div class="card" id="health-insights-card" style="margin-bottom: 1rem;">
                <div class="card-header">
                    <span class="card-title"><i data-lucide="heart-pulse" class="icon"></i> Health Insights</span>
                    <button class="btn-ghost" onclick="refreshHealthData()" title="Refresh health data">
                        <i data-lucide="refresh-cw" class="icon"></i>
                    </button>
                </div>
                <div class="card-content" id="health-insights-content">
                    <div class="skeleton"></div>
                </div>
            </div>

            <div class="life-grid">
                <!-- Progress Rings Card -->
                <div class="card life-card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="circle-dot" class="icon"></i> Today's Progress</span>
                    </div>
                    <div class="card-content">
                        <div class="progress-rings-container" id="progress-rings">
                            <canvas id="rings-canvas" width="200" height="200"></canvas>
                            <div class="rings-legend" id="rings-legend"></div>
                        </div>
                    </div>
                </div>

                <!-- Life Balance Radar -->
                <div class="card life-card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="radar" class="icon"></i> Life Balance</span>
                        <span class="card-badge">This Week</span>
                    </div>
                    <div class="card-content">
                        <div class="radar-container">
                            <canvas id="life-radar-chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Area Cards Grid -->
                <div class="card full-width life-card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="layout-grid" class="icon"></i> Life Areas</span>
                    </div>
                    <div class="card-content">
                        <div class="life-areas-grid" id="life-areas-grid">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Streaks -->
                <div class="card life-card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="flame" class="icon"></i> Streaks</span>
                    </div>
                    <div class="card-content" id="streaks-content">
                        <div class="skeleton"></div>
                    </div>
                </div>

                <!-- Days Since -->
                <div class="card life-card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="clock" class="icon"></i> Days Since</span>
                    </div>
                    <div class="card-content" id="days-since-content">
                        <div class="skeleton"></div>
                    </div>
                </div>

                <!-- Recent Achievements -->
                <div class="card life-card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="trophy" class="icon"></i> Achievements</span>
                        <button class="btn-ghost" onclick="showAllAchievements()">View All</button>
                    </div>
                    <div class="card-content" id="achievements-content">
                        <div class="skeleton"></div>
                    </div>
                </div>

                <!-- Activity Heat Map -->
                <div class="card full-width life-card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="calendar-days" class="icon"></i> Activity Heat Map</span>
                        <span class="card-badge">Last 12 weeks</span>
                    </div>
                    <div class="card-content">
                        <div class="heatmap-container" id="activity-heatmap">
                            <!-- GitHub-style heatmap -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Plan Tab -->
        <div id="tab-plan" class="tab-content">
            <div class="plan-container">
                <!-- Left: Context Panel -->
                <div class="card" style="overflow-y: auto;">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="clipboard-list" class="icon"></i> Context</span>
                        <button class="refresh-btn" onclick="loadPlanContext()" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">
                            <i data-lucide="refresh-cw" class="icon"></i>
                        </button>
                    </div>
                    <div class="card-content" id="plan-context">
                        <div class="skeleton"></div>
                    </div>
                </div>

                <!-- Right: Chat Panel -->
                <div class="card" style="display: flex; flex-direction: column;">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="message-square" class="icon"></i> Planning Chat</span>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <span id="plan-session-status" class="connection-status disconnected">
                                <span class="dot"></span> Not connected
                            </span>
                            <button id="plan-session-btn" class="refresh-btn" onclick="togglePlanSession()" style="padding: 0.25rem 0.75rem; font-size: 0.75rem;">Start Session</button>
                        </div>
                    </div>

                    <!-- Messages -->
                    <div id="plan-messages" style="flex: 1; overflow-y: auto; padding: 1rem; display: flex; flex-direction: column; gap: 0.75rem;">
                        <div class="plan-empty-state">
                            <i data-lucide="sparkles" class="icon"></i>
                            <h3>Plan Your Day</h3>
                            <p>Start a session to get personalized recommendations based on your tasks and context.</p>
                            <div class="plan-tips">
                                <div class="plan-tips-title">Try asking:</div>
                                <ul>
                                    <li><i data-lucide="target" class="icon"></i> What should I focus on first?</li>
                                    <li><i data-lucide="alert-circle" class="icon"></i> What's blocking me?</li>
                                    <li><i data-lucide="calendar" class="icon"></i> Reschedule low priority tasks</li>
                                    <li><i data-lucide="bar-chart" class="icon"></i> Give me a quick summary</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Input -->
                    <div class="chat-input-container">
                        <div class="chat-input-row">
                            <input type="text" id="plan-input" class="chat-input" placeholder="What should I focus on today?"
                                   onkeypress="if(event.key==='Enter')sendPlanMessage()" disabled>
                            <button onclick="sendPlanMessage()" id="plan-send-btn" class="chat-send-btn" disabled>
                                <i data-lucide="send" class="icon"></i> Send
                            </button>
                        </div>
                        <div class="quick-actions">
                            <button class="quick-action" onclick="sendQuickAction('What should I focus on first?')" disabled>
                                <i data-lucide="target" class="icon"></i> Focus
                            </button>
                            <button class="quick-action" onclick="sendQuickAction('What\'s blocking me?')" disabled>
                                <i data-lucide="alert-circle" class="icon"></i> Blockers
                            </button>
                            <button class="quick-action" onclick="sendQuickAction('Reschedule low priority tasks')" disabled>
                                <i data-lucide="calendar" class="icon"></i> Reschedule
                            </button>
                            <button class="quick-action" onclick="sendQuickAction('Give me a quick summary')" disabled>
                                <i data-lucide="bar-chart" class="icon"></i> Summary
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="tab-analytics" class="tab-content">
            <!-- Sub-tabs for detail views -->
            <div class="sub-tabs">
                <button class="sub-tab active" onclick="switchAnalyticsSubTab('overview')">Overview</button>
                <button class="sub-tab" onclick="switchAnalyticsSubTab('git')">Git Details</button>
                <button class="sub-tab" onclick="switchAnalyticsSubTab('tasks')">Task Details</button>
                <button class="sub-tab" onclick="switchAnalyticsSubTab('linear')">Linear Details</button>
                <button class="sub-tab" onclick="switchAnalyticsSubTab('overnight')">Overnight Sprints</button>
            </div>

            <!-- Overview Sub-content -->
            <div id="analytics-overview" class="analytics-sub-content active">
                <div class="period-selector">
                    <button class="period-btn active" onclick="setPeriod(7)">7 Days</button>
                    <button class="period-btn" onclick="setPeriod(14)">14 Days</button>
                    <button class="period-btn" onclick="setPeriod(30)">30 Days</button>
                </div>

                <div class="stat-grid" id="stat-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="stat-commits">-</div>
                        <div class="stat-label">Total Commits</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-active-repos">-</div>
                        <div class="stat-label">Active Repos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-tasks">-</div>
                        <div class="stat-label">Tasks Today</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-kanban">-</div>
                        <div class="stat-label">In Progress</div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title"><i data-lucide="git-commit" class="icon"></i> Git Activity</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="chart-git"></canvas>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title"><i data-lucide="kanban" class="icon"></i> Kanban Flow</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="chart-kanban"></canvas>
                        </div>
                    </div>
                    <div class="card full-width">
                        <div class="card-header">
                            <span class="card-title"><i data-lucide="bar-chart-3" class="icon"></i> Linear Issues</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="chart-linear"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Git Details Sub-content -->
            <div id="analytics-git" class="analytics-sub-content">
                <div class="card full-width">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="folder-git-2" class="icon"></i> All Repositories</span>
                    </div>
                    <div class="card-content" id="git-detail-content" style="max-height: 600px; overflow-y: auto;">
                        <div class="skeleton"></div>
                    </div>
                </div>
            </div>

            <!-- Tasks Details Sub-content -->
            <div id="analytics-tasks" class="analytics-sub-content">
                <div class="card full-width">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="clipboard-list" class="icon"></i> All Tasks</span>
                    </div>
                    <div class="card-content" id="tasks-detail-content" style="max-height: 600px; overflow-y: auto;">
                        <div class="skeleton"></div>
                    </div>
                </div>
            </div>

            <!-- Linear Details Sub-content -->
            <div id="analytics-linear" class="analytics-sub-content">
                <div class="stat-grid" id="linear-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="linear-stat-total">-</div>
                        <div class="stat-label">Total Issues</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="linear-stat-inprogress">-</div>
                        <div class="stat-label">In Progress</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="linear-stat-todo">-</div>
                        <div class="stat-label">Todo</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="linear-stat-backlog">-</div>
                        <div class="stat-label">Backlog</div>
                    </div>
                </div>
                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title"><i data-lucide="play-circle" class="icon"></i> In Progress</span>
                        </div>
                        <div class="card-content" id="linear-inprogress-content" style="max-height: 400px; overflow-y: auto;">
                            <div class="skeleton"></div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title"><i data-lucide="circle" class="icon"></i> Todo</span>
                        </div>
                        <div class="card-content" id="linear-todo-content" style="max-height: 400px; overflow-y: auto;">
                            <div class="skeleton"></div>
                        </div>
                    </div>
                    <div class="card full-width">
                        <div class="card-header">
                            <span class="card-title"><i data-lucide="inbox" class="icon"></i> Backlog</span>
                        </div>
                        <div class="card-content" id="linear-backlog-content" style="max-height: 400px; overflow-y: auto;">
                            <div class="skeleton"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Overnight Sprints Sub-content -->
            <div id="analytics-overnight" class="analytics-sub-content">
                <div class="overnight-layout">
                    <!-- Left: Sprint History Sidebar -->
                    <div class="card" style="overflow-y: auto;">
                        <div class="card-header">
                            <span class="card-title"><i data-lucide="scroll" class="icon"></i> Sprint History</span>
                            <span class="card-badge" id="overnight-history-count">-</span>
                        </div>
                        <div class="card-content" id="overnight-history" style="max-height: none;">
                            <div class="skeleton"></div>
                        </div>
                    </div>

                    <!-- Right: Current Sprint Details -->
                    <div class="card" style="overflow-y: auto;">
                        <div class="card-header">
                            <span class="card-title"><i data-lucide="moon" class="icon"></i> Sprint Details</span>
                            <span class="card-badge" id="overnight-date">-</span>
                        </div>
                        <div class="card-content" id="overnight-content" style="max-height: none;">
                            <div class="skeleton"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- School Tab -->
        <div id="tab-school" class="tab-content">
            <!-- Processing Status Bar -->
            <div class="school-status-bar">
                <div class="school-status-info">
                    <i data-lucide="clock" class="icon"></i>
                    <span>Last processed: <span id="school-last-run">--</span></span>
                    <span class="school-status-divider">•</span>
                    <span id="school-actions-count">-- actions</span>
                </div>
                <button class="btn-secondary btn-sm" onclick="refreshSchoolTab()">
                    <i data-lucide="refresh-cw" class="icon"></i> Refresh
                </button>
            </div>

            <!-- Summary Stats -->
            <div class="school-summary-stats" id="school-summary-stats">
                <div class="school-stat">
                    <span class="school-stat-value" id="school-total-actions">-</span>
                    <span class="school-stat-label">Total Actions</span>
                </div>
                <div class="school-stat urgency-high">
                    <span class="school-stat-value" id="school-high-count">-</span>
                    <span class="school-stat-label">High Priority</span>
                </div>
            </div>

            <!-- Children Container -->
            <div id="school-children-container">
                <div class="skeleton" style="height: 200px;"></div>
            </div>
        </div>

        <!-- Financial Tab -->
        <div id="tab-financial" class="tab-content">
            <!-- Financial Header -->
            <div class="financial-header">
                <div class="financial-status" id="financial-status">
                    <i data-lucide="wallet" class="icon"></i>
                    <span>Connecting to Monzo...</span>
                </div>
                <a href="http://localhost:5173" target="_blank" class="btn-secondary btn-sm" title="Open full Monzo dashboard">
                    <i data-lucide="external-link" class="icon"></i> Full Dashboard
                </a>
            </div>

            <!-- Summary Stats Row -->
            <div class="stat-grid" id="financial-stats">
                <div class="stat-card">
                    <div class="stat-value" id="financial-balance">-</div>
                    <div class="stat-label">Balance</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="financial-spend-today">-</div>
                    <div class="stat-label">Spent Today</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="financial-spend-month">-</div>
                    <div class="stat-label">This Month</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="financial-transactions">-</div>
                    <div class="stat-label">Transactions</div>
                </div>
            </div>

            <div class="dashboard-grid two-col">
                <!-- Spending Trend -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="trending-down" class="icon"></i> Spending Trend</span>
                        <span class="card-badge">Last 30 days</span>
                    </div>
                    <div class="card-content">
                        <div style="height: 200px;">
                            <canvas id="spending-trend-chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Top Categories -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="pie-chart" class="icon"></i> Top Categories</span>
                    </div>
                    <div class="card-content" id="financial-categories">
                        <div class="skeleton"></div>
                    </div>
                </div>

                <!-- Recurring/Subscriptions -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="repeat" class="icon"></i> Subscriptions</span>
                        <span class="card-badge" id="subscriptions-total">-/mo</span>
                    </div>
                    <div class="card-content" id="financial-subscriptions">
                        <div class="skeleton"></div>
                    </div>
                </div>

                <!-- Budget Status -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="target" class="icon"></i> Budget Status</span>
                    </div>
                    <div class="card-content" id="financial-budgets">
                        <div class="skeleton"></div>
                    </div>
                </div>
            </div>

            <!-- Offline Message -->
            <div class="card" id="financial-offline" style="display: none;">
                <div class="card-content">
                    <div class="empty-state">
                        <div class="empty-state-icon"><i data-lucide="wifi-off" class="icon"></i></div>
                        <div class="empty-state-text">Monzo service is not running</div>
                        <div class="empty-state-hint">
                            The Monzo analysis backend needs to be started.<br>
                            <code style="font-size: 0.8rem; background: var(--bg-secondary); padding: 0.5rem; border-radius: 4px; display: inline-block; margin-top: 0.5rem;">
                                cd ~/dev/dashboards/monzo-analysis && docker compose up -d
                            </code>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- RSS/News Tab -->
        <div id="tab-rss" class="tab-content">
            <!-- RSS Header -->
            <div class="rss-header">
                <div class="rss-status" id="rss-status">
                    <i data-lucide="rss" class="icon"></i>
                    <span>Connecting to Miniflux...</span>
                </div>
                <div class="rss-actions">
                    <a href="http://localhost:8070" target="_blank" class="btn-secondary btn-sm" title="Open Miniflux">
                        <i data-lucide="external-link" class="icon"></i> Miniflux
                    </a>
                    <button class="btn-secondary btn-sm" onclick="refreshRss()" title="Refresh feeds">
                        <i data-lucide="refresh-cw" class="icon"></i>
                    </button>
                </div>
            </div>

            <!-- Summary Stats Row -->
            <div class="stat-grid" id="rss-stats">
                <div class="stat-card">
                    <div class="stat-value" id="rss-unread">-</div>
                    <div class="stat-label">Unread</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="rss-feeds">-</div>
                    <div class="stat-label">Feeds</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="rss-categories">-</div>
                    <div class="stat-label">Categories</div>
                </div>
                <div class="stat-card clickable" onclick="filterRssStatus('starred')">
                    <div class="stat-value" id="rss-starred">-</div>
                    <div class="stat-label">Starred</div>
                </div>
            </div>

            <!-- Filter Bar -->
            <div class="rss-filter-bar">
                <div class="rss-filter-group">
                    <button class="rss-filter active" data-filter="unread" onclick="filterRssStatus('unread')">Unread</button>
                    <button class="rss-filter" data-filter="all" onclick="filterRssStatus('all')">All</button>
                    <button class="rss-filter" data-filter="starred" onclick="filterRssStatus('starred')">Starred</button>
                </div>
                <select id="rss-category-filter" class="rss-category-select" onchange="filterRssCategory(this.value)">
                    <option value="">All Categories</option>
                </select>
            </div>

            <!-- Entries by Category -->
            <div id="rss-entries" class="rss-entries">
                <div class="skeleton"></div>
            </div>

            <!-- Offline Message -->
            <div class="card" id="rss-offline" style="display: none;">
                <div class="card-content">
                    <div class="empty-state">
                        <div class="empty-state-icon"><i data-lucide="wifi-off" class="icon"></i></div>
                        <div class="empty-state-text">Miniflux is not running</div>
                        <div class="empty-state-hint">
                            Start Miniflux with:<br>
                            <code style="font-size: 0.8rem; background: var(--bg-secondary); padding: 0.5rem; border-radius: 4px; display: inline-block; margin-top: 0.5rem;">
                                brew services start miniflux
                            </code>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Overlay -->
    <div id="modal-overlay" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title"></h3>
                <button class="modal-close">
                    <i data-lucide="x" class="icon"></i>
                </button>
            </div>
            <div class="modal-body"></div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <script src="/static/js/app.js"></script>
    <script src="/static/js/kanban.js"></script>
</body>
</html>
