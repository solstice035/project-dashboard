<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Dashboard</title>
    <!-- Design System Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Playfair+Display:wght@700;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="/static/css/main.css">
</head>
<body data-theme="dark">
    <!-- Sticky Top Bar -->
    <header class="top-bar">
        <div class="top-bar-inner">
            <h1 class="logo"><i data-lucide="target" class="icon"></i> Dashboard</h1>

            <!-- Navigation Tabs -->
            <nav class="tabs">
                <button class="tab active" data-tab="command-center">
                    <i data-lucide="layout-dashboard" class="icon"></i> Command
                </button>
                <button class="tab" data-tab="life">
                    <i data-lucide="heart" class="icon"></i> Life
                </button>
                <button class="tab" data-tab="plan">
                    <i data-lucide="message-square" class="icon"></i> Plan
                </button>
                <button class="tab" data-tab="analytics">
                    <i data-lucide="trending-up" class="icon"></i> Analytics
                </button>
            </nav>

            <div class="header-right">
                <!-- Needs Attention Badge -->
                <div id="attention-badge" class="attention-badge hidden">
                    <i data-lucide="alert-triangle" class="icon"></i>
                    <span class="count">0</span>
                    <div id="attention-dropdown" class="attention-dropdown"></div>
                </div>

                <div class="status-indicators">
                    <div class="status-dot loading" id="status-git" title="Git"></div>
                    <div class="status-dot loading" id="status-todoist" title="Todoist"></div>
                    <div class="status-dot loading" id="status-kanban" title="Kanban"></div>
                    <div class="status-dot loading" id="status-linear" title="Linear"></div>
                </div>
                <button class="refresh-btn" id="refresh-btn" onclick="refreshAll()">
                    <i data-lucide="refresh-cw" class="icon"></i>
                </button>
                <span class="last-updated" id="last-updated">--:--</span>
            </div>
        </div>
    </header>

    <div class="container">

        <!-- Command Center Tab (Dashboard + Standup + Overnight combined) -->
        <div id="tab-command-center" class="tab-content active">
            <!-- NEEDS ATTENTION - Alert Section (Aggregated) -->
            <div class="card card-alert full-width" id="needs-attention-card">
                <div class="card-header" onclick="toggleNeedsAttention()">
                    <span class="card-title"><i data-lucide="alert-triangle" class="icon"></i> Needs Attention</span>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span class="card-badge urgent" id="needs-attention-count">0</span>
                        <i data-lucide="chevron-down" class="icon collapse-icon" id="needs-attention-chevron"></i>
                    </div>
                </div>
                <div class="card-content" id="needs-attention-content">
                    <div class="empty-state" id="needs-attention-empty">
                        <div class="empty-state-icon"><i data-lucide="check-circle" class="icon"></i></div>
                        <div class="empty-state-text">All clear — nothing needs immediate attention</div>
                    </div>
                    <div id="needs-attention-items" style="display: none;"></div>
                </div>
            </div>

            <!-- Hero Row: Today's Focus + In Progress -->
            <div class="dashboard-grid hero-row">
                <!-- Today's Focus (Featured Card) -->
                <div class="card card-featured" id="today-card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="target" class="icon"></i> Today's Focus</span>
                        <button class="btn-ghost" onclick="askJeevesForFocus()" title="Get AI suggestions">
                            <i data-lucide="sparkles" class="icon"></i>
                        </button>
                    </div>
                    <div class="card-content" id="todays-focus-content">
                        <div class="empty-state">
                            <div class="empty-state-icon"><i data-lucide="compass" class="icon"></i></div>
                            <div class="empty-state-text">No focus set for today</div>
                            <div class="empty-state-hint">You have <span id="ready-count">0</span> items ready to start</div>
                            <button class="btn-primary" onclick="switchTab('plan')">
                                <i data-lucide="sparkles" class="icon"></i> Plan with Jeeves
                            </button>
                        </div>
                    </div>
                </div>

                <!-- In Progress -->
                <div class="card" id="inprogress-card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="play-circle" class="icon"></i> In Progress</span>
                        <span class="card-badge" id="inprogress-count">0</span>
                    </div>
                    <div class="card-content" id="inprogress-content">
                        <div class="empty-state">
                            <div class="empty-state-icon"><i data-lucide="rocket" class="icon"></i></div>
                            <div class="empty-state-text">Nothing actively in progress</div>
                            <div class="empty-state-hint">Ready to start something?</div>
                            <button class="btn-secondary" onclick="showReadyItems()">
                                <i data-lucide="list" class="icon"></i> View Ready Items
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Summary Stats Row - Compact -->
            <div class="stat-grid">
                <div class="stat-card">
                    <div class="stat-value" id="standup-overdue-count">-</div>
                    <div class="stat-label">Overdue</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="standup-today-count">-</div>
                    <div class="stat-label">Today</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="standup-inprogress-count">-</div>
                    <div class="stat-label">Active</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="standup-date">-</div>
                    <div class="stat-label" id="standup-weather">Weather</div>
                </div>
            </div>

            <!-- Secondary Row: Ready Items + Activity -->
            <div class="dashboard-grid">
                <!-- Ready / Next Up -->
                <div class="card" id="ready-card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="list-checks" class="icon"></i> Ready / Next Up</span>
                        <span class="card-badge" id="ready-badge">0</span>
                    </div>
                    <div class="card-content" id="ready-content"><div class="skeleton"></div></div>
                </div>

                <!-- Activity Summary -->
                <div class="card" id="activity-card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="activity" class="icon"></i> Activity Summary</span>
                    </div>
                    <div class="card-content" id="activity-content"><div class="skeleton"></div></div>
                </div>
            </div>

            <!-- Collapsed Repository Health -->
            <div class="card collapsible" id="git-card">
                <div class="card-header" onclick="toggleGitRepos()">
                    <span class="card-title"><i data-lucide="folder-git-2" class="icon"></i> Repository Health</span>
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <span class="card-summary" id="git-summary">- repos • - dirty • - commits</span>
                        <i data-lucide="chevron-down" class="icon collapse-icon" id="git-chevron"></i>
                    </div>
                </div>
                <div class="card-content collapsed" id="git-content"><div class="skeleton"></div></div>
            </div>

            <!-- Data Sources Row (Collapsed by default) -->
            <div class="dashboard-grid sources-row">
                <!-- Todoist Tasks -->
                <div class="card" id="todoist-card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="clipboard-list" class="icon"></i> Tasks</span>
                        <span class="card-badge" id="todoist-count">-</span>
                    </div>
                    <div class="card-content" id="todoist-content"><div class="skeleton"></div></div>
                </div>

                <!-- Kanban Board -->
                <div class="card" id="kanban-card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="trello" class="icon"></i> Kanban</span>
                        <span class="card-badge" id="kanban-count">-</span>
                    </div>
                    <div class="card-content" id="kanban-content"><div class="skeleton"></div></div>
                </div>

                <!-- Linear Issues -->
                <div class="card" id="linear-card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="bar-chart-3" class="icon"></i> Linear</span>
                        <span class="card-badge" id="linear-count">-</span>
                    </div>
                    <div class="card-content" id="linear-content"><div class="skeleton"></div></div>
                </div>
            </div>
        </div>

        <!-- Life Balance Tab -->
        <div id="tab-life" class="tab-content">
            <!-- XP Header Bar -->
            <div class="life-header">
                <div class="life-level">
                    <span class="level-badge" id="life-level">Lv 1</span>
                    <div class="level-info">
                        <span class="level-title" id="life-title">Novice</span>
                        <span class="level-xp" id="life-xp">0 XP</span>
                    </div>
                </div>
                <div class="xp-progress-container">
                    <div class="xp-progress-bar">
                        <div class="xp-progress-fill" id="xp-progress-fill" style="width: 0%"></div>
                    </div>
                    <span class="xp-progress-text" id="xp-progress-text">0 / 100 XP to next level</span>
                </div>
                <div class="today-xp">
                    <span class="today-xp-value" id="today-xp">+0</span>
                    <span class="today-xp-label">Today</span>
                </div>
            </div>

            <!-- Quick Log Buttons -->
            <div class="quick-log-bar">
                <button class="quick-log-btn" onclick="quickLog('workout')" title="Log workout (+50 XP)">
                    <i data-lucide="dumbbell" class="icon"></i>
                    <span>Workout</span>
                </button>
                <button class="quick-log-btn" onclick="quickLog('meal')" title="Log meal (+10 XP)">
                    <i data-lucide="apple" class="icon"></i>
                    <span>Meal</span>
                </button>
                <button class="quick-log-btn" onclick="quickLog('meditation')" title="Log meditation (+25 XP)">
                    <i data-lucide="brain" class="icon"></i>
                    <span>Meditate</span>
                </button>
                <button class="quick-log-btn" onclick="quickLog('reading')" title="Log reading (+15 XP)">
                    <i data-lucide="book-open" class="icon"></i>
                    <span>Read</span>
                </button>
                <button class="quick-log-btn" onclick="quickLog('walk')" title="Log walk (+25 XP)">
                    <i data-lucide="footprints" class="icon"></i>
                    <span>Walk</span>
                </button>
                <button class="quick-log-btn" onclick="quickLog('social')" title="Log social activity (+20 XP)">
                    <i data-lucide="users" class="icon"></i>
                    <span>Social</span>
                </button>
            </div>

            <div class="life-grid">
                <!-- Progress Rings Card -->
                <div class="card life-card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="circle-dot" class="icon"></i> Today's Progress</span>
                    </div>
                    <div class="card-content">
                        <div class="progress-rings-container" id="progress-rings">
                            <canvas id="rings-canvas" width="200" height="200"></canvas>
                            <div class="rings-legend" id="rings-legend"></div>
                        </div>
                    </div>
                </div>

                <!-- Life Balance Radar -->
                <div class="card life-card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="radar" class="icon"></i> Life Balance</span>
                        <span class="card-badge">This Week</span>
                    </div>
                    <div class="card-content">
                        <div class="radar-container">
                            <canvas id="life-radar-chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Area Cards Grid -->
                <div class="card full-width life-card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="layout-grid" class="icon"></i> Life Areas</span>
                    </div>
                    <div class="card-content">
                        <div class="life-areas-grid" id="life-areas-grid">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Streaks -->
                <div class="card life-card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="flame" class="icon"></i> Streaks</span>
                    </div>
                    <div class="card-content" id="streaks-content">
                        <div class="skeleton"></div>
                    </div>
                </div>

                <!-- Recent Achievements -->
                <div class="card life-card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="trophy" class="icon"></i> Achievements</span>
                        <button class="btn-ghost" onclick="showAllAchievements()">View All</button>
                    </div>
                    <div class="card-content" id="achievements-content">
                        <div class="skeleton"></div>
                    </div>
                </div>

                <!-- Activity Heat Map -->
                <div class="card full-width life-card">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="calendar-days" class="icon"></i> Activity Heat Map</span>
                        <span class="card-badge">Last 12 weeks</span>
                    </div>
                    <div class="card-content">
                        <div class="heatmap-container" id="activity-heatmap">
                            <!-- GitHub-style heatmap -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Plan Tab -->
        <div id="tab-plan" class="tab-content">
            <div class="plan-container">
                <!-- Left: Context Panel -->
                <div class="card" style="overflow-y: auto;">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="clipboard-list" class="icon"></i> Context</span>
                        <button class="refresh-btn" onclick="loadPlanContext()" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">
                            <i data-lucide="refresh-cw" class="icon"></i>
                        </button>
                    </div>
                    <div class="card-content" id="plan-context">
                        <div class="skeleton"></div>
                    </div>
                </div>

                <!-- Right: Chat Panel -->
                <div class="card" style="display: flex; flex-direction: column;">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="message-square" class="icon"></i> Planning Chat</span>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <span id="plan-session-status" class="connection-status disconnected">
                                <span class="dot"></span> Not connected
                            </span>
                            <button id="plan-session-btn" class="refresh-btn" onclick="togglePlanSession()" style="padding: 0.25rem 0.75rem; font-size: 0.75rem;">Start Session</button>
                        </div>
                    </div>

                    <!-- Messages -->
                    <div id="plan-messages" style="flex: 1; overflow-y: auto; padding: 1rem; display: flex; flex-direction: column; gap: 0.75rem;">
                        <div class="plan-empty-state">
                            <i data-lucide="sparkles" class="icon"></i>
                            <h3>Plan Your Day</h3>
                            <p>Start a session to get personalized recommendations based on your tasks and context.</p>
                            <div class="plan-tips">
                                <div class="plan-tips-title">Try asking:</div>
                                <ul>
                                    <li><i data-lucide="target" class="icon"></i> What should I focus on first?</li>
                                    <li><i data-lucide="alert-circle" class="icon"></i> What's blocking me?</li>
                                    <li><i data-lucide="calendar" class="icon"></i> Reschedule low priority tasks</li>
                                    <li><i data-lucide="bar-chart" class="icon"></i> Give me a quick summary</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Input -->
                    <div class="chat-input-container">
                        <div class="chat-input-row">
                            <input type="text" id="plan-input" class="chat-input" placeholder="What should I focus on today?"
                                   onkeypress="if(event.key==='Enter')sendPlanMessage()" disabled>
                            <button onclick="sendPlanMessage()" id="plan-send-btn" class="chat-send-btn" disabled>
                                <i data-lucide="send" class="icon"></i> Send
                            </button>
                        </div>
                        <div class="quick-actions">
                            <button class="quick-action" onclick="sendQuickAction('What should I focus on first?')" disabled>
                                <i data-lucide="target" class="icon"></i> Focus
                            </button>
                            <button class="quick-action" onclick="sendQuickAction('What\'s blocking me?')" disabled>
                                <i data-lucide="alert-circle" class="icon"></i> Blockers
                            </button>
                            <button class="quick-action" onclick="sendQuickAction('Reschedule low priority tasks')" disabled>
                                <i data-lucide="calendar" class="icon"></i> Reschedule
                            </button>
                            <button class="quick-action" onclick="sendQuickAction('Give me a quick summary')" disabled>
                                <i data-lucide="bar-chart" class="icon"></i> Summary
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="tab-analytics" class="tab-content">
            <!-- Sub-tabs for detail views -->
            <div class="sub-tabs">
                <button class="sub-tab active" onclick="switchAnalyticsSubTab('overview')">Overview</button>
                <button class="sub-tab" onclick="switchAnalyticsSubTab('git')">Git Details</button>
                <button class="sub-tab" onclick="switchAnalyticsSubTab('tasks')">Task Details</button>
                <button class="sub-tab" onclick="switchAnalyticsSubTab('linear')">Linear Details</button>
                <button class="sub-tab" onclick="switchAnalyticsSubTab('overnight')">Overnight Sprints</button>
            </div>

            <!-- Overview Sub-content -->
            <div id="analytics-overview" class="analytics-sub-content active">
                <div class="period-selector">
                    <button class="period-btn active" onclick="setPeriod(7)">7 Days</button>
                    <button class="period-btn" onclick="setPeriod(14)">14 Days</button>
                    <button class="period-btn" onclick="setPeriod(30)">30 Days</button>
                </div>

                <div class="stat-grid" id="stat-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="stat-commits">-</div>
                        <div class="stat-label">Total Commits</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-active-repos">-</div>
                        <div class="stat-label">Active Repos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-tasks">-</div>
                        <div class="stat-label">Tasks Today</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-kanban">-</div>
                        <div class="stat-label">In Progress</div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title"><i data-lucide="git-commit" class="icon"></i> Git Activity</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="chart-git"></canvas>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title"><i data-lucide="kanban" class="icon"></i> Kanban Flow</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="chart-kanban"></canvas>
                        </div>
                    </div>
                    <div class="card full-width">
                        <div class="card-header">
                            <span class="card-title"><i data-lucide="bar-chart-3" class="icon"></i> Linear Issues</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="chart-linear"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Git Details Sub-content -->
            <div id="analytics-git" class="analytics-sub-content">
                <div class="card full-width">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="folder-git-2" class="icon"></i> All Repositories</span>
                    </div>
                    <div class="card-content" id="git-detail-content" style="max-height: 600px; overflow-y: auto;">
                        <div class="skeleton"></div>
                    </div>
                </div>
            </div>

            <!-- Tasks Details Sub-content -->
            <div id="analytics-tasks" class="analytics-sub-content">
                <div class="card full-width">
                    <div class="card-header">
                        <span class="card-title"><i data-lucide="clipboard-list" class="icon"></i> All Tasks</span>
                    </div>
                    <div class="card-content" id="tasks-detail-content" style="max-height: 600px; overflow-y: auto;">
                        <div class="skeleton"></div>
                    </div>
                </div>
            </div>

            <!-- Linear Details Sub-content -->
            <div id="analytics-linear" class="analytics-sub-content">
                <div class="stat-grid" id="linear-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="linear-stat-total">-</div>
                        <div class="stat-label">Total Issues</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="linear-stat-inprogress">-</div>
                        <div class="stat-label">In Progress</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="linear-stat-todo">-</div>
                        <div class="stat-label">Todo</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="linear-stat-backlog">-</div>
                        <div class="stat-label">Backlog</div>
                    </div>
                </div>
                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title"><i data-lucide="play-circle" class="icon"></i> In Progress</span>
                        </div>
                        <div class="card-content" id="linear-inprogress-content" style="max-height: 400px; overflow-y: auto;">
                            <div class="skeleton"></div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title"><i data-lucide="circle" class="icon"></i> Todo</span>
                        </div>
                        <div class="card-content" id="linear-todo-content" style="max-height: 400px; overflow-y: auto;">
                            <div class="skeleton"></div>
                        </div>
                    </div>
                    <div class="card full-width">
                        <div class="card-header">
                            <span class="card-title"><i data-lucide="inbox" class="icon"></i> Backlog</span>
                        </div>
                        <div class="card-content" id="linear-backlog-content" style="max-height: 400px; overflow-y: auto;">
                            <div class="skeleton"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Overnight Sprints Sub-content -->
            <div id="analytics-overnight" class="analytics-sub-content">
                <div class="overnight-layout">
                    <!-- Left: Sprint History Sidebar -->
                    <div class="card" style="overflow-y: auto;">
                        <div class="card-header">
                            <span class="card-title"><i data-lucide="scroll" class="icon"></i> Sprint History</span>
                            <span class="card-badge" id="overnight-history-count">-</span>
                        </div>
                        <div class="card-content" id="overnight-history" style="max-height: none;">
                            <div class="skeleton"></div>
                        </div>
                    </div>

                    <!-- Right: Current Sprint Details -->
                    <div class="card" style="overflow-y: auto;">
                        <div class="card-header">
                            <span class="card-title"><i data-lucide="moon" class="icon"></i> Sprint Details</span>
                            <span class="card-badge" id="overnight-date">-</span>
                        </div>
                        <div class="card-content" id="overnight-content" style="max-height: none;">
                            <div class="skeleton"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Overlay -->
    <div id="modal-overlay" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title"></h3>
                <button class="modal-close">
                    <i data-lucide="x" class="icon"></i>
                </button>
            </div>
            <div class="modal-body"></div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>
